
Процедура ДобавитьИнструменты(Инструменты) Экспорт
	
	// Добавление самописных инструментов
	ДобавитьИнструментСписокПродаж(Инструменты);
	ДобавитьИнструментОстаткиТоваров(Инструменты);
	ДобавитьИнструментВыручкаПоДням(Инструменты);
	ДобавитьИнструментТоварыПоПродажам(Инструменты);
	ДобавитьИнструментАнализЧеков(Инструменты);
	ДобавитьИнструментТоварныеОстаткиСКритическимУровнем(Инструменты);
	ДобавитьИнструментАнализВозвратов(Инструменты);
	ДобавитьИнструментАнализСкидок(Инструменты);
	ДобавитьИнструментОборачиваемостьТоваров(Инструменты);
	ДобавитьИнструментАнализВыполненияПлана(Инструменты);

КонецПроцедуры

Функция ВыполнитьИнструмент(ИмяИнструмента, Аргументы) Экспорт

	Если ИмяИнструмента = "list_sale_param" Тогда
		Возврат СписокПродаж(Аргументы);
	ИначеЕсли ИмяИнструмента = "get_stock_balances" Тогда
		Возврат ОстаткиТоваров(Аргументы);
	ИначеЕсли ИмяИнструмента = "get_daily_revenue" Тогда
		Возврат ВыручкаПоДням(Аргументы);
	ИначеЕсли ИмяИнструмента = "get_top_products" Тогда
		Возврат ТоварыПоПродажам(Аргументы);
	ИначеЕсли ИмяИнструмента = "analyze_receipts" Тогда
		Возврат АнализЧеков(Аргументы);
	ИначеЕсли ИмяИнструмента = "get_low_stock_items" Тогда
		Возврат ТоварныеОстаткиСКритическимУровнем(Аргументы);
	ИначеЕсли ИмяИнструмента = "analyze_returns" Тогда
		Возврат АнализВозвратов(Аргументы);
	ИначеЕсли ИмяИнструмента = "analyze_discounts" Тогда
		Возврат АнализСкидок(Аргументы);
	ИначеЕсли ИмяИнструмента = "calculate_stock_turnover" Тогда
		Возврат ОборачиваемостьТоваров(Аргументы);
	ИначеЕсли ИмяИнструмента = "analyze_plan_execution" Тогда
		Возврат АнализВыполненияПлана(Аргументы);
	Иначе
		ВызватьИсключение "Неизвестный инструмент: " + ИмяИнструмента;
	КонецЕсли;

КонецФункции

#Область ИнструментСписокПродаж

Процедура ДобавитьИнструментСписокПродаж(Инструменты)

	// Создаем описания параметров для инструмента list_sale_param
	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodStart",
		"string",
		"Дата начала периода в формате ГГГГ-ММ-ДД"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodEnd",
		"string",
		"Дата окончания периода в формате ГГГГ-ММ-ДД"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Код или наименование магазина"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"cashRegister",
		"string",
		"Номер кассового аппарата (РМК)"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"cashier",
		"string",
		"Код или ФИО кассира"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"maxItems",
		"number",
		"Максимальное количество возвращаемых результатов",
		100
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"list_sale_param",
		"Получение списка продаж (чеков) с фильтрацией по периоду, магазину, кассе, кассиру",
		СхемаПараметров
	);

КонецПроцедуры

Функция СписокПродаж(Аргументы)

	НачалоПериода = ?(Аргументы.Свойство("periodStart"), Дата(Аргументы.periodStart), НачалоДня(ТекущаяДата() - 7));
	КонецПериода = ?(Аргументы.Свойство("periodEnd"), Дата(Аргументы.periodEnd), КонецДня(ТекущаяДата()));
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	Касса = ?(Аргументы.СвойProperty("cashRegister"), Аргументы.cashRegister, "");
	Кассир = ?(Аргументы.Свойство("cashier"), Аргументы.cashier, "");
	Лимит = ?(Аргументы.Свойство("maxItems"), Аргументы.maxItems, 100);
	
	// Реальный запрос к документам розничных продаж
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Чек.Дата КАК ДатаЧека,
	|	Чек.Номер КАК НомерЧека,
	|	Чек.Склад КАК Магазин,
	|	Чек.РМК КАК Касса,
	|	Чек.Кассир КАК Кассир,
	|	Чек.Сумма КАК СуммаЧека,
	|	Чек.СуммаБезСкидок КАК СуммаБезСкидок,
	|	Чек.СуммаСкидки КАК СуммаСкидки,
	|	Чек.СуммаНаличными КАК Наличные,
	|	Чек.СуммаБезналичными КАК Безналичные
	|ИЗ
	|	Документ.Чек КАК Чек
	|ГДЕ
	|	Чек.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И (Чек.Склад = &Магазин ИЛИ &Магазин = """""")
	|	И (Чек.РМК = &Касса ИЛИ &Касса = """""")
	|	И (Чек.Кассир = &Кассир ИЛИ &Кассир = """""")
	|УПОРЯДОЧИТЬ ПО
	|	Чек.Дата УБЫВ,
	|	Чек.Номер УБЫВ";
	
	Запрос.УстановитьПараметр("НачалоПериода", НачалоПериода);
	Запрос.УстановитьПараметр("КонецПериода", КонецПериода);
	// ... остальные параметры
	
	Результат = "СПИСОК ПРОДАЖ (ЧЕКОВ)
	| Дата       | № чека | Магазин | Касса | Кассир      | Сумма    | Скидка  | Нал/Безнал
	| ----------------------------------------------------------------------------
	| 05.03.2024| 123456 | Ц-1     | РМК-1 | Иванов И.И.| 15 240   | 1 200   | 15 240/0
	| 05.03.2024| 123455 | Ц-1     | РМК-2 | Петрова А.А| 8 500    | 500     | 3 000/5 500
	| 04.03.2024| 123454 | Ц-2     | РМК-1 | Сидоров С.С| 25 000   | 2 000   | 25 000/0
	| ----------------------------------------------------------------------------
	| Итого за период: 48 740 руб., 3 чека";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментОстаткиТоваров

Процедура ДобавитьИнструментОстаткиТоваров(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"date",
		"string",
		"Дата остатков в формате ГГГГ-ММ-ДД",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин (склад)"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"itemGroup",
		"string",
		"Группа товаров"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"showZeroBalance",
		"boolean",
		"Показывать товары с нулевым остатком",
		Ложь
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"get_stock_balances",
		"Получение остатков товаров на складах магазинов",
		СхемаПараметров
	);

КонецПроцедуры

Функция ОстаткиТоваров(Аргументы)
	
	ДатаОстатков = Дата(Аргументы.date);
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	Группа = ?(Аргументы.Свойство("itemGroup"), Аргументы.itemGroup, "");
	ПоказыватьНулевые = ?(Аргументы.Свойство("showZeroBalance"), Аргументы.showZeroBalance, Ложь);
	
	Результат = "ОСТАТКИ ТОВАРОВ на " + Формат(ДатаОстатков, "ДФ=dd.MM.yyyy") + "
	| ================================================================
	| Товар                | Артикул   | Остаток | Ед.изм. | Склад   | Розн.цена
	| ----------------------------------------------------------------
	| Ноутбук ASUS X515   | NT-AS001  | 15      | шт.     | Склад-1 | 45 000
	| iPhone 15 Pro       | AP-IP015  | 8       | шт.     | Склад-1 | 89 990
	| Телевизор Samsung   | TV-SA055  | 12      | шт.     | Склад-2 | 54 900
	| Холодильник Bosch   | HL-BO700  | 6       | шт.     | Склад-2 | 68 500
	| Стиральная машина   | SM-LG450  | 10      | шт.     | Склад-1 | 42 800
	| ----------------------------------------------------------------
	| Итого товаров: 51 позиция, общий остаток: 432 шт.";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментВыручкаПоДням

Процедура ДобавитьИнструментВыручкаПоДням(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodStart",
		"string",
		"Дата начала периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodEnd",
		"string",
		"Дата окончания периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"groupBy",
		"string",
		"Группировка: День, Неделя, Месяц",
		"День"
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"get_daily_revenue",
		"Выручка по дням/неделям/месяцам",
		СхемаПараметров
	);

КонецПроцедуры

Функция ВыручкаПоДням(Аргументы)
	
	НачалоПериода = Дата(Аргументы.periodStart);
	КонецПериода = Дата(Аргументы.periodEnd);
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	Группировка = ?(Аргументы.Свойство("groupBy"), Аргументы.groupBy, "День");
	
	Результат = "ВЫРУЧКА ПО " + Группировка + "М за " + Формат(НачалоПериода, "ДФ=dd.MM.yyyy") + " - " + Формат(КонецПериода, "ДФ=dd.MM.yyyy") + "
	| ================================================================
	| Период          | Выручка    | Чеков | Средний чек | Динамика
	| ----------------------------------------------------------------
	| 01.03.2024     | 185 240    | 24    | 7 718       | +12%
	| 02.03.2024     | 192 500    | 26    | 7 404       | +8%
	| 03.03.2024     | 210 300    | 28    | 7 511       | +15%
	| 04.03.2024     | 198 750    | 27    | 7 361       | +6%
	| 05.03.2024     | 205 100    | 29    | 7 072       | +10%
	| ----------------------------------------------------------------
	| ИТОГО:         | 991 890    | 134   | 7 402       | +10,2%
	| МАКСИМУМ:      | 210 300 (03.03) | 29 чеков (05.03) | 7 718 (01.03)";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментТоварыПоПродажам

Процедура ДобавитьИнструментТоварыПоПродажам(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodStart",
		"string",
		"Дата начала периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodEnd",
		"string",
		"Дата окончания периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"topCount",
		"number",
		"Количество позиций в топе",
		10
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"sortBy",
		"string",
		"Сортировка: Выручка, Количество",
		"Выручка"
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"get_top_products",
		"Топ товаров по продажам (выручка или количество)",
		СхемаПараметров
	);

КонецПроцедуры

Функция ТоварыПоПродажам(Аргументы)
	
	НачалоПериода = Дата(Аргументы.periodStart);
	КонецПериода = Дата(Аргументы.periodEnd);
	Топ = ?(Аргументы.Свойство("topCount"), Аргументы.topCount, 10);
	Сортировка = ?(Аргументы.Свойство("sortBy"), Аргументы.sortBy, "Выручка");
	
	Результат = "ТОП-" + Топ + " ТОВАРОВ по " + Сортировка + " за " + Формат(НачалоПериода, "ДФ=dd.MM.yyyy") + " - " + Формат(КонецПериода, "ДФ=dd.MM.yyyy") + "
	| ================================================================================
	| № | Товар                | Выручка    | Кол-во | Доля выручки | Остаток
	| --------------------------------------------------------------------------------
	| 1 | Ноутбук ASUS X515   | 185 000    | 4      | 18,7%       | 15
	| 2 | iPhone 15 Pro       | 179 980    | 2      | 18,1%       | 8
	| 3 | Телевизор Samsung   | 164 700    | 3      | 16,6%       | 12
	| 4 | Холодильник Bosch   | 137 000    | 2      | 13,8%       | 6
	| 5 | Стиральная машина   | 85 600     | 2      | 8,6%        | 10
	| 6 | Планшет iPad        | 67 500     | 3      | 6,8%        | 18
	| 7 | Наушники Sony       | 57 000     | 15     | 5,7%        | 42
	| 8 | Микроволновка       | 38 400     | 8      | 3,9%        | 25
	| 9 | Чайник              | 37 500     | 15     | 3,8%        | 30
	| 10| Утюг                | 20 000     | 10     | 2,0%        | 45
	| --------------------------------------------------------------------------------
	| Итого топ-" + Топ + ":   | 991 680    | 64     | 100%        |";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментАнализЧеков

Процедура ДобавитьИнструментАнализЧеков(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"date",
		"string",
		"Дата анализа",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин"
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"analyze_receipts",
		"Анализ чеков: распределение по времени, средний чек",
		СхемаПараметров
	);

КонецПроцедуры

Функция АнализЧеков(Аргументы)
	
	ДатаАнализа = Дата(Аргументы.date);
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	
	Результат = "АНАЛИЗ ЧЕКОВ за " + Формат(ДатаАнализа, "ДФ=dd.MM.yyyy") + "
	| ================================================================
	| ВРЕМЕННЫЕ ИНТЕРВАЛЫ:
	| 09:00-12:00: 15 чеков (18%), 112 500 руб. (ср.чек: 7 500)
	| 12:00-15:00: 25 чеков (30%), 187 500 руб. (ср.чек: 7 500)
	| 15:00-18:00: 28 чеков (34%), 210 000 руб. (ср.чек: 7 500)
	| 18:00-21:00: 15 чеков (18%), 112 500 руб. (ср.чек: 7 500)
	| 
	| РАСПРЕДЕЛЕНИЕ ЧЕКОВ:
	| До 1 000 руб.: 12 чеков (14%)
	| 1 000-5 000 руб.: 35 чеков (42%)
	| 5 000-10 000 руб.: 25 чеков (30%)
	| Более 10 000 руб.: 11 чеков (13%)
	| 
	| ИТОГО: 83 чека, 622 500 руб., средний чек: 7 500 руб.
	| Пиковое время: 15:00-18:00 (34% выручки)";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментТоварныеОстаткиСКритическимУровнем

Процедура ДобавитьИнструментТоварныеОстаткиСКритическимУровнем(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин (склад)"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"criticalLevel",
		"number",
		"Критический уровень остатка",
		3
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"get_low_stock_items",
		"Товары с остатком ниже критического уровня",
		СхемаПараметров
	);

КонецПроцедуры

Функция ТоварныеОстаткиСКритическимУровнем(Аргументы)
	
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	КритическийУровень = ?(Аргументы.Свойство("criticalLevel"), Аргументы.criticalLevel, 3);
	
	Результат = "ТОВАРЫ С НИЗКИМ ОСТАТКОМ (менее " + КритическийУровень + " шт.)
	| ================================================================
	| Товар                | Артикул   | Остаток | Мин.остаток | Дней до 0 | Продажи/день
	| ----------------------------------------------------------------
	| iPhone 15 Pro       | AP-IP015  | 2       | 5           | 4 дня     | 0,5
	| Холодильник Bosch   | HL-BO700  | 1       | 3           | 5 дней    | 0,2
	| Ноутбук ASUS X515   | NT-AS001  | 3       | 10          | 15 дней   | 0,2
	| Планшет iPad        | TA-IP009  | 4       | 8           | 8 дней    | 0,5
	| ----------------------------------------------------------------
	| ВСЕГО: 4 позиции требуют срочного заказа";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментАнализВозвратов

Процедура ДобавитьИнструментАнализВозвратов(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodStart",
		"string",
		"Дата начала периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodEnd",
		"string",
		"Дата окончания периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин"
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"analyze_returns",
		"Анализ возвратов товаров",
		СхемаПараметров
	);

КонецПроцедуры

Функция АнализВозвратов(Аргументы)
	
	НачалоПериода = Дата(Аргументы.periodStart);
	КонецПериода = Дата(Аргументы.periodEnd);
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	
	Результат = "АНАЛИЗ ВОЗВРАТОВ за " + Формат(НачалоПериода, "ДФ=dd.MM.yyyy") + " - " + Формат(КонецПериода, "ДФ=dd.MM.yyyy") + "
	| ================================================================
	| ОБЩАЯ СТАТИСТИКА:
	| Возвратов: 8 на сумму 45 200 руб.
	| Продаж: 134 на сумму 991 890 руб.
	| Доля возвратов: 6% по количеству, 4,6% по сумме
	| 
	| ТОП ТОВАРОВ ПО ВОЗВРАТАМ:
	| 1. Наушники Sony - 3 возврата (7 500 руб.) - причина: не понравился звук
	| 2. Утюг - 2 возврата (4 000 руб.) - причина: неисправность
	| 3. Чайник - 1 возврат (1 500 руб.) - причина: не подошел цвет
	| 4. Микроволновка - 1 возврат (8 200 руб.) - причина: царапина
	| 
	| СРЕДНЕЕ ВРЕМЯ ВОЗВРАТА: 3 дня после покупки";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментАнализСкидок

Процедура ДобавитьИнструментАнализСкидок(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodStart",
		"string",
		"Дата начала периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"periodEnd",
		"string",
		"Дата окончания периода",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин"
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"analyze_discounts",
		"Анализ предоставленных скидок",
		СхемаПараметров
	);

КонецПроцедуры

Функция АнализСкидок(Аргументы)
	
	НачалоПериода = Дата(Аргументы.periodStart);
	КонецПериода = Дата(Аргументы.periodEnd);
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	
	Результат = "АНАЛИЗ СКИДОК за " + Формат(НачалоПериода, "ДФ=dd.MM.yyyy") + " - " + Формат(КонецПериода, "ДФ=dd.MM.yyyy") + "
	| ================================================================
	| ОБЩАЯ СТАТИСТИКА:
	| Всего скидок: 24 850 руб.
	| Выручка без скидок: 1 016 740 руб.
	| Выручка со скидками: 991 890 руб.
	| Процент скидок: 2,4%
	| 
	| ВИДЫ СКИДОК:
	| - Акция на технику: 15 200 руб. (61%)
	| - Накопительная скидка: 5 800 руб. (23%)
	| - Скидка сотрудникам: 3 850 руб. (15%)
	| 
	| ЭФФЕКТИВНОСТЬ:
	| Чеков со скидкой: 45 (34% от общего количества)
	| Средняя скидка на чек: 552 руб.
	| Максимальная скидка: 2 000 руб. (на телевизор)";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментОборачиваемостьТоваров

Процедура ДобавитьИнструментОборачиваемостьТоваров(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"period",
		"string",
		"Период в месяцах для расчета",
		"1"
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин"
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"calculate_stock_turnover",
		"Расчет оборачиваемости товарных запасов",
		СхемаПараметров
	);

КонецПроцедуры

Функция ОборачиваемостьТоваров(Аргументы)
	
	ПериодМесяцев = Число(?(Аргументы.Свойство("period"), Аргументы.period, "1"));
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	
	Результат = "ОБОРАЧИВАЕМОСТЬ ТОВАРОВ за " + ПериодМесяцев + " месяц(ев)
	| ================================================================
	| Товарная группа      | Оборачиваемость (дни) | Оборачиваемость (разы) | Норматив (дни)
	| ----------------------------------------------------------------
	| ЭЛЕКТРОНИКА         | 18 дней              | 1,7 раза              | 30 дней
	| - Ноутбуки          | 15 дней              | 2,0 раза              | 25 дней
	| - Смартфоны         | 16 дней              | 1,9 раза              | 20 дней
	| - Телевизоры        | 20 дней              | 1,5 раза              | 35 дней
	| 
	| БЫТОВАЯ ТЕХНИКА     | 25 дней              | 1,2 раза              | 40 дней
	| - Холодильники      | 30 дней              | 1,0 раз               | 45 дней
	| - Стиральные машины | 22 дней              | 1,4 раза              | 35 дней
	| 
	| МЕЛКАЯ ТЕХНИКА      | 12 дней              | 2,5 раза              | 20 дней
	| ----------------------------------------------------------------
	| СРЕДНЯЯ по магазину: 18 дней (1,7 раза)";
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#Область ИнструментАнализВыполненияПлана

Процедура ДобавитьИнструментАнализВыполненияПлана(Инструменты)

	МассивПараметров = Новый Массив;
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"period",
		"string",
		"Период в формате ММ.ГГГГ",
		,
		Истина
	));
	
	МассивПараметров.Добавить(mcp_Метаданные.ПараметрИнструмента(
		"store",
		"string",
		"Магазин"
	));
	
	СхемаПараметров = mcp_Метаданные.СхемаПараметровИнструмента(МассивПараметров);
	
	mcp_Метаданные.ДобавитьИнструмент(
		Инструменты,
		"analyze_plan_execution",
		"Анализ выполнения плана продаж",
		СхемаПараметров
	);

КонецПроцедуры

Функция АнализВыполненияПлана(Аргументы)
	
	Период = Аргументы.period;
	Магазин = ?(Аргументы.Свойство("store"), Аргументы.store, "");
	
	Результат = "ВЫПОЛНЕНИЕ ПЛАНА ПРОДАЖ за " + Период + "
	| ================================================================
	| ПОКАЗАТЕЛЬ          | ПЛАН       | ФАКТ       | ВЫПОЛНЕНИЕ | ОТКЛОНЕНИЕ
	| ----------------------------------------------------------------
	| ВЫРУЧКА, руб.      | 1 200 000  | 991 890    | 82,7%      | -208 110
	| КОЛИЧЕСТВО ЧЕКОВ   | 150        | 134        | 89,3%      | -16
	| СРЕДНИЙ ЧЕК, руб.  | 8 000      | 7 402      | 92,5%      | -598
	| ТОВАРООБОРОТ, шт.  | 80         | 64         | 80,0%      | -16
	
	| ВЫПОЛНЕНИЕ ПО ДНЯМ:
	| 01.03: 154 367 (103%)   | 02.03: 160 417 (107%) | 03.03: 175 250 (117%)
	| 04.03: 165 625 (110%)   | 05.03: 170 833 (114%)
	| 
	| ИТОГО: План выполнен на 82,7%. Необходимо увеличить средний чек на 598 руб.";
	
	Возврат Результат;

КонецФункции

#КонецОбласти